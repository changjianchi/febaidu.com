# 李佳隆

> 从2016-10-21到2016-10-28


## 日志自动化测试

### 背景


* 增强日志稳定性,自动化测试日志


### 完成情况

* <span>目前已完成webb日志的接口测试用例,日志内容测试用例后续迭代</span>
* <span>下周和雨梅对下怎么接入他们的测试框架,在www上线的时候监控日志</span>
* <span>雨梅休假,下周再对一下详细方案</span>
* <span>调整了方案,改为注入测试,以监控www-wise上线对日志的影响,开发中</span>
* <span>完善测试用例，修复phantomjs程序bug。基本完成接口测试内容, 下周和雨梅对一下内容测试的方案.</span>
* <span>添加测试内容必选字段是否合法，测试模拟发送时机</span>
* <span>接入karma管理测试，支持代码覆盖率报表. 完善测试用例中,总进度60%</span>
* <span>在雨梅机器上搭建测试环境，整合进www-wise的ci流程。</span>
* <span style="color:red;">完善测试用例span>

## wise webb重构

### 背景

* 以前的webb.js代码比较老旧,逻辑太复杂,可读性非常差. 但后续要对webb日志进行重大功能升级, 重构代码是一项必不可少的工作,也为今后的功能升级打好基础.

* 目前日志模块没有统一的测试用例,测试需人工测试,无法完整覆盖测试的风险较高.

### 目标

* 提取功能性,有明确输入输出的方法 -> 简化逻辑提高可读性

* 重构部分实现 -> 让代码更合理,可读性更强

* 添加完整注释 -> 增强可读性

* 引入测试框架编写测试用例 -> 提高代码健壮性. 减轻测试压力


### 进展

* 7.4 开始重构

* 7.7日抽样上线 

* <span>针对web.js的底层日志逻辑,写了测试用例</span>

* <span>将日志存储拆分为一个模块,公共方法拆分为一个模块</span>

* <span> ubs还没给出结论,已看过2天的数据,正常波动. 还需要看1天的数据,无问题后转全</span>

* <span>首版实验结论是不明显负向,迭代了一版,下周出实验结论</span>

* <span>重做了全局实验,已上线,预计下周出结论</span>

* <span>ubs 同学休假了,下周给结论</span>

* <span>修复一个bug,继续实验</span>

* <span>可能实验流量有问题，修改流量为5% ,继续实验</span>

* <span>hadoop集群挂了，数据没跑出来</span>

* <span>实验符合预期，预计下周全量</span>

* <span>已全量，待分析影响结果</span>

* <span style="color:red;">配合异步机制，重构webb-ia 逻辑，改成单例模式</span>


## 日志本地存储/发送机制(无更新)

### 背景

* 页面在卸载（如用户关闭浏览器标签、点击链接跳转）时，日志可能会受到浏览器策略影响发送失败，卸载日志比例仅有xx%。所以，我们需要建立一个日志本地存储/发送机制，将待发送的日志写入本地存储，日志成功接收后（服务端返回成功码）从存储队列里删除。若期间出现页面卸载，则在下次用户进入页面的时候继续发送。

### 目标 

* 目前丢失率为27% , 目标将卸载日志成功率提升至10%。

### 进展

* 7.8 开始调研 , 7.11 开始开发, 7.15代码上线, 7.20 完成效果验证

* <span>将unload发送日志,改为onbeforeunload事件发送日志</span>

* <span>添加本地存储功能,所有日志操作均会同步本地缓存. 代码已上线,待测试</span>

* <span>已全量，待分析影响结果</span>

* <span>上线后丢失率增高，分析原始日志发现以didmerge的日志，然而补发的日志用的新的did，看能否紧急修复，不行就让时长的统计先不包含type=4的</span>

* <span>ubs 那边开发统计type=4的还没有上线，先上线type=2，修复了did不同的问题。丢失率没有增高，type=2增加，需要再看看是什么问题导致</span>

* <span>日志增加，但是丢失率有略微上升，目前在跑原始数据分析</span>


## 手百8.0时长上涨

### 背景 

* 手百8.0去掉小耳朵逻辑，导致时长上涨，追查原因

### 进展

* 与手百的人沟通后，无法解决。他们换成webkit内核了。机制上改动。只能重新调整时长算法。

* 算法调整已经确认,给qa测试

## 阿拉丁组件开发

### 背景

* 开发阿拉丁组件

### 进展

* 开发完成，提测完成

## 整理日志文档(无进展)

### 背景

* 以前的日志过于混乱，不适合新手阅读。整理日志最新规范

### 进展

* 完成整体结构整理,内容需要进一步整理


## 整理sfe www的文档(无进展)

### 背景

* 迁移到新的文档平台

### 进展

* 9.2日梳理基本思路，预计下周完成基本结构迁移

* <span>www结构迁移基本完成</span>

