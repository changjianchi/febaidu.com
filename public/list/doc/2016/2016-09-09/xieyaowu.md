# 谢耀武

> 2016-09-05 到 2016-09-09

## 基础+机制

1. 推动删除pad.tpl - 已上线
2. showlamp长线模板支持 - 已上线
3. 梳理foot不规范的模板，推动升级 - 高优
5. 配合@朱雷升级栅格化调整 - 高优
4. 修复哥伦布组收起按钮2个bug - 优
    1. 子卡数量不够时出bug修复 - [http://newicafe.baidu.com/issue/ps-santa-37/show?from=page](http://newicafe.baidu.com/issue/ps-santa-37/show?from=page)
    1. 展开收起按钮上边界不符合规范
1. 哥伦布里点后推bug跟进
1. 梳理www-wise里的aladdin相关代码 - [http://sfe.baidu.com/#/搜索结果页/无线搜索整体规范/www-wise基础UI+JS规范+&+重构](http://sfe.baidu.com/#/搜索结果页/无线搜索整体规范/www-wise基础UI+JS规范+&+重构)
5. 调研c_base中`title block`的需求
6. 跟@qijian、@yuanwei再对下模板编译时fis合并amd文件

## 上线优化

### 1.0 - 已上线

通过短线优化上线打包(ala_template.tar.gz)、删除pad.tpl、@小琴的下线130个模板3个点，于0906（周二）上午上线，经过3天观察上线流程、线上展现均符合预期，优化前后的时间对比:

名称 | 优化前 | 优化后
--- | --- | ---
smarty 10+个模板编译时间  | 190s   | 130s
smarty全量编译时间 | 775s |421s
ala_template.tar.gz | 35M | 19M
aladdin文件个数 | 1253 | 874
level1-level3上线 | 90分钟 | 45-55分钟
20个模板整体上线时间(从模板编译到全量完成) | 3小时 | 2小时

#### 预计单模板上线 - 1小时10分钟内

* 平台编译->确认->上线 - 6分钟
    * 创建任务->fis编译完成 90s
    * smarty编译完成 120s
    * 生成cr 20s
    * 确认效果 60s
    * 发布上线 40s
* agile平台操作 5分钟
* 模板单台 5分钟
* 模板确认 1分钟
* 模板全量 45分钟

#### 2.0方案 - 预计0919-0923开发并上线

1. 冗余文件的整理 - 定期自动分析无使用的静态文件、删除无用的php文件
1. 打包脚本优化 - 优化fis编译临时目录（解决同时编译冲突）、smarty打包前merge老模板优化、引用删除文件提示
1. 人工确认时间点的优化 - 沙盒验证优化、明确check时间点（待定）
1. 找op沟通批量level时的并发数

#### 3.0 - 自动化上线 - Q4完成

依赖：

1. 一休支持@功能
1. 整体上线压缩到60-80分钟以内
1. 明确单台没确认直接上线带来的风险和屏蔽问题
1. 看863有没有查询进度接口，没有就走轮询

功能点：

1. 定点自动编译，编译后自动通知
1. 到点不确认自动踢除并重新编译
1. 群里回复【确认】自动关联进度
1. 单台确认超时自动下一步（当然有待评审）
1. 群里可以查询上线进度
1. 人工干预

### 2. wise支持showlamp上线 - 已上线

aladdin-wise基础模板升级了对【aladdin审核平台】配置showlamp，可以资源级的配置模板是否展现aladdin小图标，由于影响面较大，提测qa@雨梅所有模板展现diff，并在开发平台上稳定运行一周，于0905（周一）下午上线，线上观察4天展现符合预期。

至此模板已经支持showurl、showlamp、灰色来源站点功能，只需要提供对应数据即可，但梳理出155个模板代码上使用不规范，涉及的规范如:

自定义showurl颜色、使用非正确的showurl样式
写死aladdin图标
模板底部自定认写死
以上几点对统一升级有影响，梳理的list: http://wiki.baidu.com/pages/viewpage.action?pageId=210400281 ，我再找相关的接口人确认并确认一起推动吧

<a name="pro" id="pro"></a>
### 3. 针对产品规范的平台需求 - 已上线

主要通过平台的一些展现数据分析，方便查出常用的case，辅助推动统一化、规范化，也方便回归进度。

在 [【模板浏览】](http://tpldev.baidu.com/#explore) 页面添加`展现特型`标签，以天级更新对有展现的模板展现标记对应的标签，但也只是辅助，因为是query级的，而一个模板可能被10个资源，100个query召回，而标记是根据某一召回的query打点，目前已有的特型 :

* mip图标 - 模板左下角展现了mip图标
* 绿色showurl - 模板显示绿色的showurl
* 不显示绿色showurl - 上面相反
* aladdin小图标 - 模板显示aladdin图标
* 不显示aladdin小图标 - 上面相反
* 站点来源 - 模板左下角显示灰色的站点来源
* 不显示站点来源 - 上面相反
* 右侧文字链接 - 模板右下角显示 文字+> 链接
* 右侧链接 - 模板右下角显示  > 链接
* 没有foot右侧 - 模板没有右下角链接
* 没有整个foot - 模板没有整个底部foot
* sigma1.0
* sigma2.0
* 情景页2.0 - 模板里有sf2.0入口
* 官网图标 - 模板标题中有蓝色的`官网`图标
* 非栅格化 - 模板未使用栅格化

以上特型是使用规范标记统计，每天使用展现日志数据更新（展现日志有一定的延迟），可能有模板使用不规范导致标记错误，如有发现可以联系xieyaowu@跟进，谢谢。

通过这些特型可以方便的查出目前有展现的sigma1.0、非栅格化模板等例子。

#### 3.2 线下跑出sf1.0模板

实时查询出目前有使用sf1.0方法的aladdin-wise模板（代码层面），并给出对应query和最近的chengelog，列表如下(内网): [http://api.baidumd.com/sf1.0/](http://api.baidumd.com/sf1.0/)

#### 3.3 线下跑出sigma1.0模板

实时查询出目前还存在sigma1.0模板`iphone.only.tpl`的aladdin-wise模板，并给出对应query和最近的chengelog，列表如下(内网): [http://api.baidumd.com/sigma1.0/](http://api.baidumd.com/sigma1.0/)

> sigma1.0升级成2.0应该把对应的老文件删除，删除上线后刷新即可生效

#### 3.4 aladdin天级数据日志 - 彩蛋

结合目前已有的模板文件总数、展现特型分析、sigma1.0模板文件总数等数据，以天级储存下来，方便后续的查看和统计。

日志地址(内网): [http://log.alafe.org/](http://log.alafe.org/)

> `alafe.org`域名是我注册，绑定的测试机，使用测试机+端口不好记，并且测试机更换后还得更新url

### 标准库预览、管理 - @张屾 - 10月初上线
### 易用性和功能升级 - @张屾

1.  针对card类型的模板也需要有确认效果的过程 （本周五9.9开发完毕，自测，下周联调＋review、上线）
2.  编辑的模板提供下载压缩包的功能 （9.19-9.20调研即熟悉流程，9.21-9.22开发，9.23自测review，9.26上线）
3.  模板列表展开收起   （纯前端功能 9.26-9.27 2天开发自测review上线）

### 准入优化 - @张屾

1.  数据转码检查、跨模板引用检查、新增模板黑名单检查 （10.8-10.11 开发自测，10.12review上线）
2.  类名检查、数据结构检查 （10.13开发自测，10.14review上线）

### 重构积分系统 - 3天 - 9月底上线

针对积分模块进行重构, 想在前端代码不大范围修改的情况下, 引入静态资源管理以及构建机制

针对目前积分管理存在的不合理处进行优化, 解放值周人员的手动操作频次

1. 支持天级自动通知
1. 支持周级自动通知
1. 考虑是否使用新的前端架构

### card添加抓图预览 - 3天 - 优化级低 - 10月上线
