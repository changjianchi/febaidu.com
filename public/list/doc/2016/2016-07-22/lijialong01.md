# 李佳隆

> 从2016-7-15到2016-7-22


## 日志自动化测试

### 背景


* 增强日志稳定性,自动化测试日志


### 完成情况

* <span>目前已完成webb日志的接口测试用例,日志内容测试用例后续迭代</span>
* <span style="color:red;">下周和雨梅对下怎么接入他们的测试框架,在www上线的时候监控日志</span>

## mip页面tc日志带上加密nsrc

### 背景

* 在tc日志中带上mip页的原url


### 完成情况

* <span style="color:red;">经和刘悦,白松等人员沟通后, WA_LOG_SF会带上mip页原网址的加密url,预计下周上线</span>


## 在sf2.0中添加webb日志模块

### 背景

* sf2.0的同步页中需要统计时长,lid依赖结果页传入. 需要升级组件到sf2.0中


### 完成情况

* <span style="color:red;">代码升级完成, 但依赖webb重构实验的结论, 下周出实验结论.下周上线</span>

## wise webb重构

### 背景

* 以前的webb.js代码比较老旧,逻辑太复杂,可读性非常差. 但后续要对webb日志进行重大功能升级, 重构代码是一项必不可少的工作,也为今后的功能升级打好基础.

* 目前日志模块没有统一的测试用例,测试需人工测试,无法完整覆盖测试的风险较高.

### 目标

* 提取功能性,有明确输入输出的方法 -> 简化逻辑提高可读性

* 重构部分实现 -> 让代码更合理,可读性更强

* 添加完整注释 -> 增强可读性

* 引入测试框架编写测试用例 -> 提高代码健壮性. 减轻测试压力

### 进展

* 7.4 开始重构

* 7.7日抽样上线 

* <span>针对web.js的底层日志逻辑,写了测试用例</span>

* <span>将日志存储拆分为一个模块,公共方法拆分为一个模块</span>

* <span> ubs还没给出结论,已看过2天的数据,正常波动. 还需要看1天的数据,无问题后转全</span>

* <span style="color:red;">首版实验结论是不明显负向,迭代了一版,下周出实验结论</span>


## 日志本地存储/发送机制

### 背景

* 页面在卸载（如用户关闭浏览器标签、点击链接跳转）时，日志可能会受到浏览器策略影响发送失败，卸载日志比例仅有xx%。所以，我们需要建立一个日志本地存储/发送机制，将待发送的日志写入本地存储，日志成功接收后（服务端返回成功码）从存储队列里删除。若期间出现页面卸载，则在下次用户进入页面的时候继续发送。

### 目标 

* 目前丢失率为27% , 目标将卸载日志成功率提升至10%。

### 进展

* 7.8 开始调研 , 7.11 开始开发, 7.15代码上线, 7.20 完成效果验证

* <span>将unload发送日志,改为onbeforeunload事件发送日志</span>

* <span>添加本地存储功能,所有日志操作均会同步本地缓存. 代码已上线,待测试</span>

* <span style="color:red;">开发完毕,依赖webb重构实验结论</span>


## 公共issue收集

### 背景

* 为开发者能分享自己的开发经验,或者遇到过的坑提供一个交流平台,形成问题集.作为sfe文档的补充.
* [传送门](http://gitlab.baidu.com/psfe/ala-duty-case/issues)

### 最新进展

